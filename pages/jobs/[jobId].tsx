import Head from 'next/head';
import { useRouter } from 'next/router';
import Layout from '../../Components/Layout';
import { deleteJobByJobId, getJobByJobId } from '../../util/database';

export default function SingleJob(props: any) {
  const router = useRouter();
  async function deleteJobByJobI(id: any) {
    await fetch(`http://localhost:3000/api/jobs/${props.job.id}`, {
      method: 'DELETE',
    });
    router.push(`/jobs`);
  }
  return (
    <>
      <Head>
        <title>{props.username}</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Layout username={props.username} />
      <h3>{props.job.title}</h3>
      <p>
        {props.job.regionsTitle} {console.log(props.username)}
      </p>
      <span>
        {props.username ? (
          <button onClick={() => deleteJobByJobI(props.job.id)}>Delete</button>
        ) : (
          <button>Apply</button>
        )}
      </span>
    </>
  );
}

export async function getServerSideProps(context: any) {
  let jobid = context.query.jobId;
  const job = await getJobByJobId(jobid);

  console.log('job', job);
  return {
    props: {
      job: job,
    },
  };
}
